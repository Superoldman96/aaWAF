import{u as e,a}from"./auth.03aa3fe5.1742181728921.js";import{_ as t}from"./index.d676ac21.1742181728921.js";import{cZ as l,f as s,R as i,S as n,bN as o,u as r,au as u,r as d,e as c,m as p,l as v,n as _,bQ as m,o as f,a2 as y,$ as h}from"./index.fc641b56.1742181728921.js";import{d as g,o as k,b as x,e as b,U as w,f as j,P as U,k as C,ae as R,c as S,S as K,aa as I,_ as z,F as W,ac as L,$ as O,r as E,y as F,K as P,u as q,ad as B,X as M,Z as D,p as G}from"./vue.314199b7.1742181728921.js";import{_ as N}from"./index.vue_vue_type_script_setup_true_lang.6f36d91a.1742181728921.js";import{_ as X}from"./index.vue_vue_type_script_setup_true_lang.5eb11789.1742181728921.js";import{_ as Z}from"./Checkbox.64335fca.1742181728921.js";import{_ as $}from"./index.vue_vue_type_script_setup_true_lang.141d1f64.1742181728921.js";import{_ as Q}from"./index.vue_vue_type_script_setup_true_lang.dd273c02.1742181728921.js";import{a as T,s as A,r as H,d as J,g as V}from"./area.05904c14.1742181728921.js";import{_ as Y}from"./index.vue_vue_type_script_setup_true_lang.80349023.1742181728921.js";import{_ as ee}from"./index.2dfef82f.1742181728921.js";import{a as ae,c as te}from"./area.fbb35970.1742181728921.js";import{_ as le}from"./Cascader.126528d1.1742181728921.js";import{_ as se}from"./RadioButton.7959355d.1742181728921.js";import{_ as ie,c as ne,a as oe}from"./DataTable.762c357a.1742181728921.js";import{_ as re}from"./ButtonGroup.012fc319.1742181728921.js";import{_ as ue}from"./utils.d31cac41.1742181728921.js";const de={class:"p-40px"},ce=w("div",{class:"mb-20px text-24px"},"根据访问者地区限制访问",-1),pe=w("div",{class:"mb-36px leading-20px text-desc text-13px"},[C(" 在实际业务中我们的业务通常是有区域性的，如遇到不是目标区域的大量恶意访问"),w("br"),C(" 可以通过此功能来限制访问区域 ")],-1),ve=g({__name:"free",setup(e){const a=l();return(e,l)=>{const o=s,r=i,u=t,d=n;return k(),x(d,{class:"w-900px mt-20px mx-auto"},{default:b((()=>[w("div",de,[ce,pe,j(o,{type:"primary",onClick:l[0]||(l[0]=e=>U(a).showPay())},{default:b((()=>[C("立即开通")])),_:1}),j(r,{class:"!my-32px",dashed:""}),w("div",null,[j(u,{src:U("/static/images/area.b2296cf4.1742181728921.png")},null,8,["src"])])])])),_:1})}}}),_e={class:"flex items-center pl-1px"},me={key:0,class:"flex flex-center w-36px mr-8px"},fe=g({__name:"index",props:{data:{default:()=>[]},rowKey:{type:Function,default:e=>e.id},options:{},checkedKeys:{default:()=>[]},showCheckbox:{type:Boolean,default:!0}},setup(e){const a=e,t=R(a,"checkedKeys"),l=S({get(){const{checkedKeys:e,data:t}=a;return e.length>0&&e.length===t.length},set(e){t.value=e?a.data.map((e=>a.rowKey(e))):[]}}),i=S((()=>{const{checkedKeys:e,data:t}=a;return e.length>0&&e.length<t.length})),n=S((()=>0===t.value.length)),o=S((()=>0===a.data.length));return(e,a)=>{const r=Z,u=s;return k(),K("div",_e,[e.showCheckbox?(k(),K("div",me,[j(r,{checked:U(l),"onUpdate:checked":a[0]||(a[0]=e=>I(l)?l.value=e:null),disabled:U(o),indeterminate:U(i)},null,8,["checked","disabled","indeterminate"])])):z("",!0),w("div",null,[(k(!0),K(W,null,L(e.options,(e=>(k(),K(W,null,[!1!==e.show?(k(),x(u,{key:e.key,class:"mr-1.2rem",type:e.type,disabled:U(n),onClick:a=>e.event(U(t))},{default:b((()=>[C(O(e.label),1)])),_:2},1032,["type","disabled","onClick"])):z("",!0)],64)))),256))])])}}}),ye={class:"mt-12px"},he=w("br",null,null,-1),ge=w("br",null,null,-1),ke={class:"mt-8px"},xe={class:"w-300px"},be={class:"mt-8px"},we={class:"w-300px"},je=g({__name:"index",props:{type:{default:"city"},region:{default:()=>[]}},setup(e,{expose:a}){const t=e,l=R(t,"type"),i=R(t,"region"),n=E("common"),o=E("domestic"),r=E([]),u=E(ae.map(((e,a)=>0===a?{label:e,value:"海外"}:1===a?{label:e,value:"中国"}:2===a?{label:e,value:"香港"}:3===a?{label:e,value:"澳门"}:4===a?{label:e,value:"台湾"}:{label:e,value:e}))),d=()=>{i.value=u.value.map((e=>e.value))},c=()=>{i.value=[]},p=e=>{"common"===e?(l.value="city",o.value="domestic",i.value=["中国"]):(l.value=e,i.value=[])},v=e=>{i.value="domestic"===e?["中国"]:"overseas"===e?["海外"]:["全中国"]};return(()=>{const{list:e,category:a,relations:t}=te,{provinces:l}=a,s=[];l.forEach((a=>{const l={label:e[a][0],value:e[a][0],children:[]},i=t[a];i?i.forEach((a=>{var t;null==(t=l.children)||t.push({label:e[a][0],value:e[a][0]})})):delete l.children,s.push(l)})),r.value=s})(),a({setOption:e=>{n.value=e}}),(e,a)=>{const t=se,l=ie,_=ne,m=le,f=s,y=re,h=oe;return k(),K("div",null,[w("div",null,[j(l,{value:U(n),"onUpdate:value":[a[0]||(a[0]=e=>I(n)?n.value=e:null),p]},{default:b((()=>[j(t,{value:"common"},{default:b((()=>[C("常用选项")])),_:1}),j(t,{value:"province"},{default:b((()=>[C("国内省市")])),_:1}),j(t,{value:"city"},{default:b((()=>[C("全球地区")])),_:1})])),_:1},8,["value"])]),F(w("div",ye,[j(l,{value:U(o),"onUpdate:value":[a[1]||(a[1]=e=>I(o)?o.value=e:null),v]},{default:b((()=>[j(_,{value:"domestic"},{default:b((()=>[C("中国大陆(不包括[中国特别行政区:港,澳,台])")])),_:1}),he,j(_,{class:"mt-10px",value:"overseas"},{default:b((()=>[C(" 中国大陆以外的地区(包括[中国特别行政区:港,澳,台]) ")])),_:1}),ge,j(_,{class:"mt-10px",value:"China"},{default:b((()=>[C("中国(包括[中国特别行政区:港,澳,台])")])),_:1})])),_:1},8,["value"])],512),[[P,"common"===U(n)]]),F(w("div",ke,[w("div",xe,[j(m,{value:U(i),"onUpdate:value":a[2]||(a[2]=e=>I(i)?i.value=e:null),multiple:"",filterable:"",options:U(r),placeholder:"请选择国内省市"},null,8,["value","options"])])],512),[[P,"province"===U(n)]]),F(w("div",be,[w("div",we,[j(h,{value:U(i),"onUpdate:value":a[3]||(a[3]=e=>I(i)?i.value=e:null),multiple:"",filterable:"",options:U(u),"max-tag-count":"responsive",placeholder:"请选择地区"},{action:b((()=>[j(y,null,{default:b((()=>[j(f,{onClick:d},{default:b((()=>[C("全选")])),_:1}),j(f,{onClick:c},{default:b((()=>[C("取消全选")])),_:1})])),_:1})])),_:1},8,["value","options"])])],512),[[P,"city"===U(n)]])])}}}),Ue={class:"w-300px"},Ce=g({__name:"index",props:{id:{default:null}},setup(e,{expose:a}){const t=e,l=o(),s=R(t,"id"),i=E([{label:"全部网站",value:"allsite"}]),{loading:n,setLoading:c}=r();(async()=>{try{c(!0);const{res:e}=await u(),{list:a}=e;d(a)&&(i.value=a.map(((e,a)=>(0===a&&(s.value=e.site_id),{label:e.site_name,value:e.site_id}))),i.value.unshift({label:"全部网站",value:"allsite"}),l.siteId&&(s.value=l.siteId))}finally{c(!1)}})();return a({reset:()=>{l.siteId?s.value=l.siteId:s.value=i.value[1].value}}),(e,a)=>{const t=oe;return k(),K("div",Ue,[j(t,{value:U(s),"onUpdate:value":a[0]||(a[0]=e=>I(s)?s.value=e:null),filterable:!0,loading:U(n),options:U(i),placeholder:"请选择网站"},null,8,["value","loading","options"])])}}}),Re={class:"w-120px"},Se={class:"flex"},Ke={class:"w-240px mr-12px"},Ie=g({__name:"index",emits:["refresh"],setup(a,{emit:t}){const l=E(),i=q({type:"refuse",region:["中国"],add_type:"city",site_ids:null,uri:""}),o=q({site_ids:{required:!0,trigger:"change",validator:()=>""!==i.site_ids||new Error("网站最少选一个!")},area:{required:!0,validator:()=>0!==i.region.length||new Error("地区最少选一个!")}}),r=E(null),u=E([{label:"拦截",value:"refuse"},{label:"只允许",value:"accept"}]),d=async()=>{var a;await(null==(a=r.value)?void 0:a.validate());const l={...B(i),site_ids:i.site_ids?[i.site_ids]:[]};if(-1===l.region.indexOf("中国")||-1===l.region.indexOf("海外"))try{await T(l),t("refresh"),f()}catch(s){e("地区限制",s)}else c("不允许设置【中国大陆】和【中国大陆以外地区】一同开启地区限制!")},m=E(),f=()=>{var e,a;i.type="refuse",i.region=["中国"],i.add_type="city",i.uri="",null==(e=m.value)||e.reset(),null==(a=l.value)||a.setOption("common")};return(e,a)=>{const t=oe,c=p,f=v,y=ee,h=s,g=_,R=n;return k(),x(R,{class:"mb-16px",title:"添加地区限制"},{default:b((()=>[j(g,{ref_key:"formRef",ref:r,model:U(i),rules:U(o),"label-width":"100px","label-placement":"left","require-mark-placement":"left"},{default:b((()=>[j(c,{label:"类型"},{default:b((()=>[w("div",Re,[j(t,{value:U(i).type,"onUpdate:value":a[0]||(a[0]=e=>U(i).type=e),options:U(u)},null,8,["value","options"])])])),_:1}),j(c,{label:"地区",path:"area"},{default:b((()=>[j(je,{ref_key:"areaRef",ref:l,type:U(i).add_type,"onUpdate:type":a[1]||(a[1]=e=>U(i).add_type=e),region:U(i).region,"onUpdate:region":a[2]||(a[2]=e=>U(i).region=e)},null,8,["type","region"])])),_:1}),w("div",Se,[j(c,{label:"网站",path:"site_ids"},{default:b((()=>[j(Ce,{ref_key:"siteRef",ref:m,id:U(i).site_ids,"onUpdate:id":a[3]||(a[3]=e=>U(i).site_ids=e)},null,8,["id"])])),_:1}),j(c,{label:"URI","label-width":"80px"},{default:b((()=>[w("div",Ke,[j(f,{value:U(i).uri,"onUpdate:value":a[4]||(a[4]=e=>U(i).uri=e),spellcheck:"false",placeholder:"请输入URI（接口），不填默认全部"},null,8,["value"])]),j(y,null,{default:b((()=>[C(" 如：填写【/login】表示用户访问/login这个访问路径时会进行地区限制拦截 ")])),_:1})])),_:1})]),j(c,{label:" ","show-feedback":!1},{default:b((()=>[j(h,{type:"primary",onClick:d},{default:b((()=>[C("提交")])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1})}}}),ze=w("p",{class:"text-desc mb-10px"},"*注：命中次数每1分钟且需要有新请求触发才会更新一次",-1),We=g({__name:"content",setup(a){const t=o(),l=m(),{search:s}=M(l),i=q({keys:[],list:[],total:0}),u=q({p:1,p_size:10,searchStr:t.siteName}),{loading:c,setLoading:p}=r(),v=async()=>{try{i.keys=[],p(!0);const{res:e}=await V(B(u)),{list:a,total:t}=e;d(a)?(i.list=a.map((e=>({...e,regionStr:Object.keys(e.region).map((e=>g.get(e)||e)).join(",")}))),i.total=t):i.list=[]}finally{p(!1)}},_=new Map([["refuse","拦截"],["accept","只允许"]]),g=new Map([["海外","中国大陆以外的地区(包括[中国特别行政区:港,澳,台])"],["中国","中国大陆(不包括[中国特别行政区:港,澳,台])"],["全中国","中国(包括[中国特别行政区:港,澳,台])"],["香港","中国香港"],["澳门","中国澳门"],["台湾","中国台湾"]]),x=E([{type:"selection",width:36},{key:"types",title:"类型",width:"6%",minWidth:80,render:e=>_.get(e.types)||"--"},{key:"count",title:"命中次数",width:"10%",minWidth:100,render:e=>j(ue,{class:"cursor-pointer",bordered:!1,type:e.count>0?"success":"",size:"small",onClick:()=>{R(e)}},{default:()=>[e.count.toLocaleString()||0]})},{key:"status",title:"规则状态",width:"10%",minWidth:100,render:e=>j(Y,{status:e.status?1:0,onClick:()=>{S(!e.status,e)}},null)},{key:"regionStr",title:"地区",minWidth:200,ellipsis:{tooltip:{width:"trigger"}}},{key:"site",title:"网站",width:"16%",minWidth:140,render:e=>e.site||"--"},{key:"uri",title:"URI",width:"14%",minWidth:120,render:e=>e.uri||"全部"},{key:"action",title:"操作",width:140,render:e=>j(W,null,[j(f,{disabled:0===e.count,onClick:()=>{I(e)}},{default:()=>[C("清空统计")]}),j(f,{class:"ml-12px",onClick:()=>{z(e)}},{default:()=>[C("删除")]})])}]),w=D(),R=e=>{e.count>0&&(w.push("/interception"),y("log","matchRecord"),s.value.keyword=e.region_id)},S=async(a,t)=>{try{await A({region_id:t.region_id,status:a}),t.status=a}catch(l){e("地区限制",l)}},I=e=>{h({title:"清空统计",content:"确定清空统计以下规则？<br />当前规则：".concat(_.get(e.types),"【").concat(e.regionStr,"】地区的IP访问【").concat(e.site,"】"),onConfirm:async()=>{await H({region_id:e.region_id}),v()}})},z=async e=>{h({title:"删除地区限制",content:"是否删除以下规则？<br />当前规则：".concat(_.get(e.types),"【").concat(e.regionStr,"】地区的IP访问【").concat(e.site,"】"),onConfirm:async()=>{await J({region_id:[e.region_id]}),v()}})},L=[{key:"del",label:"批量删除",event:e=>{h({title:"批量删除",content:"确定要从地区限制中删除这".concat(e.length,"条规则吗？"),onConfirm:async()=>{await J({region_id:e}),v()}})}}];return G((()=>{t.resetSite()})),v(),(e,a)=>{const t=Q,l=$,s=fe,o=X,r=N,d=n;return k(),K(W,null,[j(Ie,{onRefresh:v}),j(d,{title:"地区限制列表"},{"header-extra":b((()=>[j(t,{value:U(u).searchStr,"onUpdate:value":a[0]||(a[0]=e=>U(u).searchStr=e),width:280,placeholder:"请输入网站名称/地区",onSearch:v},null,8,["value"])])),default:b((()=>[j(r,null,{content:b((()=>[ze,j(l,{"checked-row-keys":U(i).keys,"onUpdate:checkedRowKeys":a[1]||(a[1]=e=>U(i).keys=e),loading:U(c),"row-key":e=>e.region_id,data:U(i).list,columns:U(x)},null,8,["checked-row-keys","loading","row-key","data","columns"])])),pageLeft:b((()=>[j(s,{"checked-keys":U(i).keys,"onUpdate:checkedKeys":a[2]||(a[2]=e=>U(i).keys=e),data:U(i).list,"row-key":e=>e.region_id,options:L},null,8,["checked-keys","data","row-key"])])),pageRight:b((()=>[j(o,{page:U(u).p,"onUpdate:page":a[3]||(a[3]=e=>U(u).p=e),"page-size":U(u).p_size,"onUpdate:pageSize":a[4]||(a[4]=e=>U(u).p_size=e),"item-count":U(i).total,onRefresh:v},null,8,["page","page-size","item-count"])])),_:1})])),_:1})],64)}}}),Le={class:"p-16px"},Oe=g({__name:"index",setup(e){const{isFree:t}=a();return(e,a)=>(k(),K("div",Le,[U(t)?(k(),x(ve,{key:0})):(k(),x(We,{key:1}))]))}});export{Oe as _};
