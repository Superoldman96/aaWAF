import{_ as e}from"./index.vue_vue_type_script_setup_true_lang.609fbee0.1742181728921.js";import{_ as t}from"./index.0a184dde.1742181728921.js";import{_ as a}from"./index.vue_vue_type_script_setup_true_lang.6f36d91a.1742181728921.js";import{cu as l,au as n,r as s,f as o,cv as u,cw as i,cx as r,l as c,m as d,n as p,e as m,_ as v,o as _,cy as f,$ as b,cz as g,A as h}from"./index.fc641b56.1742181728921.js";import{_ as k}from"./index.vue_vue_type_script_setup_true_lang.141d1f64.1742181728921.js";import{d as w,ae as y,X as x,o as U,b as j,e as q,f as C,k as I,$ as L,J as P,P as N,aa as O,r as R,m as A,u as J,S,U as $,y as E,K as T,a2 as z,a3 as B}from"./vue.314199b7.1742181728921.js";import{_ as D}from"./ButtonGroup.012fc319.1742181728921.js";import{a as G,c as H,_ as K}from"./DataTable.762c357a.1742181728921.js";import{_ as M}from"./Checkbox.64335fca.1742181728921.js";import{N as X}from"./InputNumber.f6532dc5.1742181728921.js";import{N as F}from"./Switch.4c664df7.1742181728921.js";import"./layer.8f9c8930.1742181728921.js";import"./get-slot.a0e67e91.1742181728921.js";import"./utils.d31cac41.1742181728921.js";const Q=w({__name:"index",props:{value:{default:null},isInit:{type:Boolean,default:!0}},setup(e){const t=y(e,"value"),a=l(),{sitesOption:u}=x(a),i=()=>{t.value=u.value.map((e=>e.value))},r=()=>{t.value=[]};return(async()=>{const{res:e}=await n(),{list:t}=e;s(t)?u.value=t.map((e=>({label:e.site_name,value:e.site_id}))):u.value=[]})(),(e,a)=>{const l=o,n=D,s=G;return U(),j(s,P(e.$attrs,{value:N(t),"onUpdate:value":a[0]||(a[0]=e=>O(t)?t.value=e:null),multiple:"","max-tag-count":"responsive",options:N(u),"consistent-menu-width":!1,filterable:"",disabled:!1,placeholder:"请选择网站"}),{action:q((()=>[C(n,null,{default:q((()=>[C(l,{onClick:i},{default:q((()=>[I(L(e.$t("CustomRule.Checkbox.All")),1)])),_:1}),C(l,{onClick:r},{default:q((()=>[I(L(e.$t("CustomRule.Checkbox.NotAll")),1)])),_:1})])),_:1})])),_:1},16,["value","options"])}}}),V=e=>(z("data-v-52500f4b"),e=e(),B(),e),W={class:"w-620px"},Y=V((()=>$("div",{class:"title"},"当网站",-1))),Z=V((()=>$("div",{class:"title mt-8px"},"触发条件",-1))),ee={class:"flex-1"},te={class:"flex items-center h-32px"},ae={class:"flex items-center mt-2"},le=V((()=>$("span",{class:"h-16px"},"次",-1))),ne={class:"flex items-center mt-2"},se=V((()=>$("span",{class:"h-16px mr-2"},"秒内，超出",-1))),oe=V((()=>$("div",{class:"title mt-8px"},"响应结果",-1))),ue=v(w({__name:"index",setup(e,{expose:t}){const a=u(),l=R(!1),n=R(!1),{isEdit:s,row:o}=A("component-data"),v=J({name:"",site:[],types:"url",url:"",condition:1,region:{req:null,count:{time:null,count:null}},action:"status_403",return:"html"}),_=R(null),f=R({name:[{required:!0,message:"请输入规则名",trigger:"blur"}],url:[{required:!0,message:"请输入URL",trigger:"blur"}]}),b=e=>{"all"===e&&(v.url="/")};return s&&(v.name=o.name,v.site=Object.keys(o.site)||[],v.types=o.types,v.url=o.url,v.condition=o.condition,v.action=o.action,v.return=o.return,Object.keys(o.region).length>0?(o.region.req&&(l.value=!0,v.region.req=o.region.req,v.region.count=v.region.count||{time:null,count:null}),o.region.count.time&&(n.value=!0,v.region.count={time:o.region.count.time,count:o.region.count.count},v.region.req=v.region.req||null)):v.region={req:null,count:{time:null,count:null}}),t({onConfirm:async e=>{var t;await(null==(t=_.value)?void 0:t.validate());const u=(()=>{const e=[...v.site];if(e.includes("通配所有域名"))e.splice(e.indexOf("通配所有域名"),1,"allsite");else if(e.length<1)return m("请选择网站");let t={name:v.name,types:v.types,url:v.url,condition:v.condition,region:{},action:v.action,return:v.return,site:e.join(",")};if(l.value&&(t.region.req=Number(v.region.req)),n.value){if(!v.region.count.time)return m("请输入时间范围");if(!v.region.count.count)return m("请输入请求次数");t.region.count={time:Number(v.region.count.time),count:Number(v.region.count.count)}}return s&&(t=Object.assign(t,{id:o.id})),t})();s?await i(u):await r(u),a.getList(),e()}}),(e,t)=>{const a=c,s=d,o=G,u=H,i=K,r=M,m=X,g=p;return U(),S("div",W,[C(g,{ref_key:"formRef",ref:_,rules:N(f),model:N(v),"label-width":80,"label-placement":"left","require-mark-placement":"left"},{default:q((()=>[Y,C(s,{label:"名称",path:"name"},{default:q((()=>[C(a,{value:N(v).name,"onUpdate:value":t[0]||(t[0]=e=>N(v).name=e),spellcheck:"false",placeholder:"请输入规则名"},null,8,["value"])])),_:1}),C(s,{label:"应用到网站"},{default:q((()=>[C(Q,{value:N(v).site,"onUpdate:value":t[1]||(t[1]=e=>N(v).site=e)},null,8,["value"])])),_:1}),Z,C(s,{label:"路径"},{default:q((()=>[C(o,{value:N(v).types,"onUpdate:value":[t[2]||(t[2]=e=>N(v).types=e),b],class:"w-120px",options:[{label:"指定URL",value:"url"},{label:"全站",value:"all"}],"consistent-menu-width":!1},null,8,["value"]),C(a,{value:N(v).url,"onUpdate:value":t[3]||(t[3]=e=>N(v).url=e),path:"url",class:"ml-2",disabled:"all"===N(v).types,placeholder:"例如:/api/user/get_user_infos"},null,8,["value","disabled"])])),_:1}),C(s,{label:"访问限制"},{default:q((()=>[$("div",null,[$("div",ee,[$("div",te,[C(i,{value:N(v).condition,"onUpdate:value":t[4]||(t[4]=e=>N(v).condition=e)},{default:q((()=>[C(u,{value:1},{default:q((()=>[I("单个IP")])),_:1}),C(u,{value:2},{default:q((()=>[I("IP+UA")])),_:1}),C(u,{value:3},{default:q((()=>[I("所有IP")])),_:1})])),_:1},8,["value"])])]),$("div",ae,[C(r,{checked:N(l),"onUpdate:checked":t[5]||(t[5]=e=>O(l)?l.value=e:null)},{default:q((()=>[I("每秒访问限制")])),_:1},8,["checked"]),C(m,{value:N(v).region.req,"onUpdate:value":t[6]||(t[6]=e=>N(v).region.req=e),placeholder:"例如:10","show-button":!1,class:"w-18 mr-1"},null,8,["value"]),le]),$("div",ne,[C(r,{checked:N(n),"onUpdate:checked":t[7]||(t[7]=e=>O(n)?n.value=e:null)},{default:q((()=>[I("时间访问限制")])),_:1},8,["checked"]),C(m,{value:N(v).region.count.count,"onUpdate:value":t[8]||(t[8]=e=>N(v).region.count.count=e),placeholder:"例如:600","show-button":!1,class:"w-18 mr-1"},null,8,["value"]),se,C(m,{value:N(v).region.count.time,"onUpdate:value":t[9]||(t[9]=e=>N(v).region.count.time=e),placeholder:"例如:1800","show-button":!1,class:"w-18"},null,8,["value"])])])])),_:1}),oe,C(s,{label:"操作选项"},{default:q((()=>[C(o,{value:N(v).action,"onUpdate:value":t[10]||(t[10]=e=>N(v).action=e),options:[{label:"状态码403（拒绝访问）",value:"status_403"},{label:"状态码404（文件不存在）",value:"status_404"},{label:"状态码502（连接超时）",value:"status_502"},{label:"状态码503（服务器不可用）",value:"status_503"},{label:"返回网页内容",value:"content"},{label:"封锁IP",value:"drop"}]},null,8,["value"])])),_:1}),E(C(s,{label:"响应页面"},{default:q((()=>[C(o,{value:N(v).return,"onUpdate:value":t[11]||(t[11]=e=>N(v).return=e),options:[{label:"默认流量限制页（HTML格式）",value:"html"},{label:"默认流量限制页（Json格式）",value:"json"},{label:"444响应",value:"444"}]},null,8,["value"])])),_:1},512),[[T,"content"===N(v).action]])])),_:1},8,["rules","model"])])}}}),[["__scopeId","data-v-52500f4b"]]),ie=$("li",null,"流量限制的优先级是最低的",-1),re=$("li",null,"流量限制一般用于API接口 不建议使用全站开启",-1),ce=$("li",null,"建议的返回类型为503或者502",-1),de=w({__name:"index",setup(l){const n=u(),{table:s,loading:i}=x(n),r=J({show:!1,title:"",data:{row:{},isEdit:!1,index:null}}),c=()=>{r.show=!0,r.data.isEdit=!1,r.title="添加流量限制"},d=R([{key:"name",title:"规则名称"},{key:"site",title:"网站名",render:e=>{const t=Object.keys(e.site);return"allsite"===t[0]&&(t[0]="所有站点"),t||"-"}},{key:"url",title:"URL"},{key:"region",title:"触发条件",render:e=>{let t="";switch(e.condition){case 1:t="单个IP ";break;case 2:t="单个IP+UA ";break;case 3:t="所有IP "}const a=e.region;let l=t;return void 0!==a.req&&(l+="每秒访问设定的URL超过".concat(a.req,"次")),void 0!==a.count&&Object.keys(a.count).length>0&&(l+="".concat(void 0!==a.req?" 或在 ":"").concat(a.count.time,"秒内访问该URL超过").concat(a.count.count,"次")),"".concat(l,"时，将触发流量限制")}},{key:"action",title:"执行操作",render:e=>{let t="";switch(e.action){case"status_403":t="状态码403（拒绝访问）";break;case"status_404":t="状态码404（文件不存在）";break;case"status_502":t="状态码502（连接超时）";break;case"status_503":t="状态码503（服务器不可用）";break;case"content":t="返回网页内容";break;case"drop":t="拦截(封锁IP)"}return t}},{key:"open",title:"状态",width:"15%",render:e=>C(F,{value:e.open,"onUpdate:value":t=>e.open=t,size:"small",onClick:()=>{m(e)}},null)},{title:"操作",key:"rightAction",render:e=>C("div",{class:"action"},[C(_,{onClick:()=>p(e)},{default:()=>[I(" 编辑 ")]}),C(_,{onClick:()=>v(e)},{default:()=>[I(" 删除 ")]})])}]),p=e=>{r.show=!0,r.data.isEdit=!0;const t=JSON.parse(JSON.stringify(e));t.site.allsite&&(delete t.site.allsite,t.site["通配所有域名"]=1),r.data.row=t,r.title="编辑[".concat(e.name,"]流量限制")},m=e=>{f(e.id)},v=e=>{b({title:"删除限制【".concat(e.name,"】"),content:"是否确实要删除该限制？",onConfirm:async()=>{await g(e.id),n.getList()}})};return(async()=>{await n.getSiteList(),await n.getList()})(),(l,n)=>{const u=o,p=k,m=h,v=a,f=t,b=e;return U(),j(b,null,{default:q((()=>[C(v,null,{toolsLeft:q((()=>[C(u,{type:"primary",onClick:c},{default:q((()=>[I("添加限制")])),_:1}),C(_,{href:"https://www.bt.cn/bbs/thread-141618-1-1.html",target:"_blank",class:"ml-2"},{default:q((()=>[I(" 查看教程 ")])),_:1})])),content:q((()=>[C(p,{loading:N(i),data:N(s).data,columns:N(d)},null,8,["loading","data","columns"])])),modal:q((()=>[C(m,{show:N(r).show,"onUpdate:show":n[0]||(n[0]=e=>N(r).show=e),data:N(r).data,title:N(r).title,"is-footer":!0,component:ue},null,8,["show","data","title"])])),_:1}),C(f,{class:"mt-16px"},{default:q((()=>[ie,re,ce])),_:1})])),_:1})}}});export{de as default};
