import{h as e,u as a,j as l,k as s,l as o,m as t,f as n,n as i,o as r,_ as d,q as c,r as u,t as p,v as g,w as f,x as v,y as w,z as m,A as _,a as h}from"./index.fc641b56.1742181728921.js";import{d as y,W as L,u as k,r as b,A as $,o as x,S as U,U as C,$ as E,f as K,e as P,P as T,ah as V,k as z,ad as M,b as j,_ as q,aa as B}from"./vue.314199b7.1742181728921.js";import{_ as F}from"./index.0a184dde.1742181728921.js";const R={class:"w-340px p-8px"},S={class:"desc"},A={class:"leading-[1.4]"},I=d(y({__name:"index",setup(d){const{t:c}=L(),u=k({code:""}),p={vcode:{required:!0,message:c("Login.Verify.CodePlace")}},g=b(),f=e(),{loading:v,setLoading:w}=a(),m=async()=>{var e;try{await(null==(e=g.value)?void 0:e.validate()),w(!0);const{res:a}=await l(M(u));f.setToken(a);const{close:o}=s(c("Login.SuccessMsg"),{time:0});setTimeout((async()=>{o(),window.location.href="/"}),1500)}finally{w(!1)}},_=b();return $((()=>{var e;null==(e=_.value)||e.focus()})),(e,a)=>{const l=o,s=t,d=n,c=i,f=r,w=F;return x(),U("section",R,[C("div",S,E(e.$t("Login.Verify.Desc")),1),K(c,{ref_key:"formRef",ref:g,"label-placement":"left",model:T(u),rules:p},{default:P((()=>[K(s,{path:"code"},{default:P((()=>[K(l,{ref_key:"codeRef",ref:_,value:T(u).code,"onUpdate:value":a[0]||(a[0]=e=>T(u).code=e),"input-props":{spellcheck:!1},placeholder:e.$t("Login.Verify.CodePlace"),onKeydown:V(m,["enter"])},null,8,["value","placeholder","onKeydown"])])),_:1}),K(s,null,{default:P((()=>[K(d,{type:"primary",loading:T(v),disabled:T(v),block:"",onClick:m},{default:P((()=>[z(E(e.$t("Login.Verify.Validate")),1)])),_:1},8,["loading","disabled"])])),_:1})])),_:1},8,["model"]),K(w,null,{default:P((()=>[C("li",A,[z(E(e.$t("Login.Verify.Tips.0"))+" ",1),K(f,{class:"ml-[1.4em]",href:"https://www.kancloud.cn/kern123/cloudwaf/3200181",target:"_blank"},{default:P((()=>[z(E(e.$t("Login.Verify.Tips.1")),1)])),_:1})])])),_:1})])}}}),[["__scopeId","data-v-c568dde2"]]),D={class:"login-container"},N={class:"login-card"},W={class:"title"},G=["src"],H={class:"text"},J=["src","title"],O={class:"flex justify-end mt-4"},Q=d(y({__name:"index",setup(l){const{t:d}=L(),h=e(),y=b(!1),$=b(""),F=b("success"),R=b(""),S=b(!1),A=k({username:"",password:"",validate_code:"",validate_code_id:""}),Q={username:{required:!0,trigger:["blur","input"],validator:(e,a)=>""===a?new Error(d("Login.UsernameErrMsg.0")):!(a.length<3)||new Error(d("Login.UsernameErrMsg.1"))},password:{required:!0,trigger:["blur","input"],validator:(e,a)=>""===a?new Error(d("Login.PasswordErrMsg.0")):!(a.length<5)||new Error(d("Login.PasswordErrMsg.1"))},validate_code:{required:!0,trigger:["blur","input"],message:d("Login.CodeErrMsg.0")}},X=k({show:!1,title:d("Login.Verify.Title")}),Y=b(null),{loading:Z,setLoading:ee}=a(),ae=async()=>{var e;try{await(null==(e=Y.value)?void 0:e.validate()),ee(!0);const{res:a}=await c(M(A));if(a.two_auth)return void(X.show=!0);h.setToken(a);const{close:l}=s(d("Login.SuccessMsg"),{time:0});setTimeout((async()=>{l(),window.location.href="/"}),1200)}catch(a){if(u(a))return;oe(),p(a)&&le(a.res)}finally{ee(!1)}},le=e=>{F.value="error",R.value=e},se=b(!1),oe=async()=>{try{se.value=!0;const{res:e}=await g();e.must_validate_code&&(y.value=!0,$.value=e.validate_code_base64,A.validate_code_id=e.validate_code_id)}finally{se.value=!1}},te=k({logo:"",title:""});return(async()=>{const{res:e}=await f(),{logo:a,title:l}=e;te.logo=a,te.title=l,document.title=l})(),(e,a)=>{const l=v,s=o,d=t,c=w,u=n,p=i,g=r,f=m,h=_;return x(),U("div",D,[C("div",N,[C("div",W,[""===T(te).logo?(x(),j(l,{key:0,name:"logo-green",size:"48"})):q("",!0),""!==T(te).logo?(x(),U("img",{key:1,src:T(te).logo,alt:"Preview",class:"w-48px"},null,8,G)):q("",!0),C("div",H,E(T(te).title||e.$t("Public.Name")),1)]),K(p,{ref_key:"formRef",ref:Y,size:"large",model:T(A),rules:Q,"label-placement":"left"},{default:P((()=>[K(d,{path:"username"},{default:P((()=>[K(s,{value:T(A).username,"onUpdate:value":a[0]||(a[0]=e=>T(A).username=e),autocomplete:"on",clearable:"",placeholder:e.$t("Login.Username"),"input-props":{spellcheck:!1},onKeydown:V(ae,["enter"])},{prefix:P((()=>[K(l,{class:"mr-1",name:"username",size:"17"})])),_:1},8,["value","placeholder","onKeydown"])])),_:1}),K(d,{path:"password"},{default:P((()=>[K(s,{value:T(A).password,"onUpdate:value":a[1]||(a[1]=e=>T(A).password=e),type:"password",autocomplete:"on","show-password-on":"click",clearable:"",placeholder:e.$t("Login.Password"),"input-props":{spellcheck:!1},onKeydown:V(ae,["enter"])},{prefix:P((()=>[K(l,{class:"mr-1",name:"password",size:"17"})])),_:1},8,["value","placeholder","onKeydown"])])),_:1}),T(y)?(x(),j(d,{key:0,path:"validate_code"},{default:P((()=>[K(s,{value:T(A).validate_code,"onUpdate:value":a[2]||(a[2]=e=>T(A).validate_code=e),class:"flex-1",placeholder:e.$t("Login.Code"),"input-props":{spellcheck:!1},onKeydown:V(ae,["enter"])},null,8,["value","placeholder","onKeydown"]),C("div",{class:"code",onClick:a[3]||(a[3]=e=>oe())},[K(c,{class:"h-full",size:"small",show:T(se)},{default:P((()=>[C("img",{class:"w-full h-full",src:T($),title:e.$t("Login.CodeBtn"),alt:"验证码"},null,8,J)])),_:1},8,["show"])])])),_:1})):q("",!0),K(d,{"validation-status":T(F)},{feedback:P((()=>[z(E(T(R)),1)])),default:P((()=>[K(u,{type:"primary",size:"large",block:"",loading:T(Z),disabled:T(Z),onClick:ae},{default:P((()=>[z(E(T(Z)?e.$t("Login.BtnLoad"):e.$t("Login.Btn")),1)])),_:1},8,["loading","disabled"])])),_:1},8,["validation-status"])])),_:1},8,["model"]),C("div",O,[K(g,{type:"primary",onClick:a[4]||(a[4]=e=>S.value=!0)},{default:P((()=>[z(E(e.$t("Login.Forget"))+">>",1)])),_:1})]),K(h,{show:T(S),"onUpdate:show":a[5]||(a[5]=e=>B(S)?S.value=e:null),title:e.$t("Login.Forget")},{default:P((()=>[K(f,{"show-icon":!1},{default:P((()=>[C("span",null,E(e.$t("Login.ForgetTips")),1)])),_:1})])),_:1},8,["show","title"])]),K(h,{show:T(X).show,"onUpdate:show":a[6]||(a[6]=e=>T(X).show=e),title:T(X).title,component:I},null,8,["show","title"])])}}}),[["__scopeId","data-v-9398fed3"]]),X=y({__name:"index",setup:e=>(e,a)=>{const l=h;return x(),j(l,null,{default:P((()=>[K(Q)])),_:1})}});export{X as _};
